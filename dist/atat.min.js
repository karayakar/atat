/*! atat 2017-03-20 */
!function(){"use strict";function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function b(a,b,c){var d=this;g(k(a,b.inline),function(a,c,e,f){if(a.name==A)return b.parts.push(a.value),void f(null,"this.output += this.parts["+(b.parts.length-1)+"];");if(a.name==B){var g=a.left,h=a,i=a.right;if(""==h.value.trim())return void f(null,"");var j=b.compiler(g.value,i.value);return j?void j.call(d,h,b,f):(b.parts.push(g.value+h.value+i.value),void f("this.output += this.parts["+(b.parts.length-1)+"];"))}},function(a,b){if(a)return c(a);c(null,b.join(""))})}function c(a){var b=[],c=[];return f(a,function(a,d){d=d.split("..."),d[0]=d[0].replace(D,"\\$&"),d[1]=d[1].replace(D,"\\$&"),b.indexOf(d[0])===-1&&b.push(d[0]),c.indexOf(d[1])===-1&&c.push(d[1])}),b.sort(function(a,b){return a.length<b.length}),c.sort(function(a,b){return a.length<b.length}),{open:new RegExp(b.join("|"),"g"),close:new RegExp(c.join("|"),"g")}}function d(a){var b=[],c=[];return f(a,function(a,d){d=d.split("..."),d[0]=d[0].replace(D,"\\$&"),d[1]=d[1].replace(D,"\\$&"),b.indexOf(d[0])===-1&&b.push(d[0]),c.indexOf(d[1])===-1&&c.push(d[1])}),b.sort(function(a,b){return a.length<b.length}),c.sort(function(a,b){return a.length<b.length}),new RegExp("("+b.join("|")+")([^]*?)("+c.join("|")+")","g")}function e(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toString().replace(E,function(a){return C[a]||a})}function f(a,b){if("[object Array]"===Object.prototype.toString.call(a))for(var c=0,d=a.length;c<d;c++)b(a[c],c,a);else for(var e in a)a.hasOwnProperty(e)&&b(a[e],e,a)}function g(a,b,c){for(var d=0,e=!1,f=[],g=a.length,h=0;h<g;h++)b(a[h],h,a,function(a){return function(b,h){if(b&&!e)return e=!0,void c(b);f[a]=h,d++,e||d!=g||(e=!0,c(null,f))}}(h))}function h(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var c in a)!b.hasOwnProperty(c)&&a.hasOwnProperty(c)&&("object"==v(a[c])?b[c]=h(a[c]):b[c]=a[c]);return b}function i(a,b,c){for(var d=b.global,e=b.sticky,f=[],g=0,h=0,i=0,k=0,l=void 0,m=void 0,n=void 0,o=void 0;;){if(n=j(a,b,i),o=j(a,c,i),n&&o&&(n.index<=o.index?o=null:n=null),n||o)h=(n||o).index,i=h+(n||o)[0].length;else if(!g)break;if(e&&!g&&h>k)break;if(n)g||(l=h,m=i),++g;else{if(!o||!g)throw new Error("Unbalanced delimiter found in string");if(!--g&&(l>k&&f.push({name:A,value:a.slice(k,l),start:k,end:l}),f.push({name:B,value:a.slice(m,h),start:m,end:h,left:{value:a.slice(l,m),start:l,end:m},right:{value:a.slice(h,i),start:h,end:i}}),k=i,!d))break}h===i&&++i}return d&&a.length>k&&f.push({name:A,value:a.slice(k),start:k,end:a.length}),f}function j(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;b.lastIndex=c;var d=b.exec(a);return b.global&&(b.lastIndex=d?b.lastIndex:0),d}function k(a,b){for(var c=b.global,d=b.sticky,e=[],f=0,g=0,h=void 0,i=void 0;;){var k=j(a,b,f);if(null==k)break;if(g=k.index,d&&g>f)break;if(h=g+k[1].length,i=f+h+k[2].length,g>f&&e.push({name:A,value:a.slice(f,g),start:f,end:g}),e.push({name:B,value:k[2],start:h,end:i,left:{value:k[1],start:g,end:h},right:{value:k[3],start:i,end:i+k[3].length}}),f=g+k[0].length,!c)break}return c&&a.length>f&&e.push({name:A,value:a.slice(f),start:f,end:a.length}),e}function l(a,b,c){c(null,a.value.trim())}function m(a,b,c){var d="for"+a.value+"}",e=i(d,/\{/g,/\}/g),f="";f+=e[0].value,f+="{",this.compile(e[1].value,b,function(a,b){if(a)return c(a);f+=b,f+="}",c(null,f)})}function n(a,b,c){c(null,"function "+a.value.trim()+"}")}function o(a,b,c){var d=this;g(i("if"+a.value+"}",/\{/g,/\}/g),function(a,c,e,f){if(a.name==A)return f(null,a.value);d.compile(a.value,b,f)},function(a,b){if(a)return c(a);c(null,b.join(""))})}function p(a,b,c){c(null,"this.output += $.encode(("+a.value.trim()+')||"");')}function q(a,b,c){c(null,"this.output += (("+a.value.trim()+')||"");')}function r(a,b,c){if(b.__layout)return c();z.compileUri(a.value.trim(),b.options,function(a,d){b.__layout=d,c()})}function s(a,b,c){var d=a.value.trim(),e=j(d,/^([^\s]*)\s/g);if(!e&&""==d)return c(new Error("Partial parsing error"));var f=e?e[0]:d,g="";e&&2==e.length&&(f=e[1],g=d.slice(e[0].length).trim()),z.compileUri(f,b.options,function(a,d){if(a)return c(a);b.__partials.push(d),c(null,"this.output += this.__partials["+(b.__partials.length-1)+"]("+g+");")})}function t(a,b,c){var d=a.value.trim(),e=j(d,/^\s*([A-Za-z0-9]+)\s*\{/g),f=d.replace(/^\s*([A-Za-z0-9]+)\s*\{/g,"");if(!e&&e.length>1)return c(new Error("Section parsing error"));var g=e[1].trim();if(b.__sections[g])return c(new Error("Section already exists"));this.compile(f,b,function(a,d){if(a)return c(a);b.__sections[g]=d,c(null)})}function u(a,b,c){var d="while"+a.value+"}",e=i(d,/\{/g,/\}/g),f="";f+=e[0].value,f+="{",this.compile(e[1].value,b,function(a,b){if(a)return c(a);f+=b,f+="}",c(null,f)})}var v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},w=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),x=function(){function c(){a(this,c)}return w(c,[{key:"compile",value:function(a,c,d){var e=this;g(i(a,c.tags.open,c.tags.close),function(a,d,f,g){if(a.name==A)return""==a.value.trim()?void g(null,""):void b.call(e,a.value,c,g);if(a.name==B){var h=a.left,i=a,j=a.right,k=c.compiler(h.value,j.value);return k?void k.call(e,i,c,g):void b.call(e,h.value+i.value+j.value,c,g)}},function(a,b){if(a)return d(a);d(null,b.join(""))})}}]),c}(),y=function(){function b(e){a(this,b),this.options=h(z.options,e),this.output="",this.model=null,this.helpers=this.options.helpers,this.parts=[],this.arguments=[this.options.modelname,this.options.helpersname,"body"].join(","),this.tags=c(this.options.tags),this.inline=d(this.options.inline),this.__layout=null,this.__partials=[],this.__sections=[]}return w(b,[{key:"compiler",value:function(a,b){return this.options.tags[a+"..."+b]||this.options.inline[a+"..."+b]}}]),b}(),z=function(){function b(){a(this,b)}return w(b,null,[{key:"compileUri",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};arguments.length>2&&void 0!==arguments[2]&&arguments[2];"function"==typeof b&&(b,b={})}},{key:"compile",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};"function"==typeof b&&(c=b,b={});var d=new y(b);(new x).compile(a,d,function(a,b){if(a)return c(a);var e=new Function(d.arguments,b+";return this.output;");d.template=function(a){d.output="",d.model=a||d.model;var b=e.call(d,d.model,d.helpers,d.body);return d.__layout&&(d.__layout.__context.body=b,b=d.__layout(d.model)),b},d.template.__context=d,c(null,d.template)})}}]),b}();z.options={modelname:"model",helpersname:"$",tags:{"@{...}@":l,"@if...}@":o,"@while...}@":u,"@for...}@":m,"@function...}@":n,"@section...}@":t},inline:{"@layout(...)@":r,"@partial(...)@":s,"@(...)@":p,"@!(...)@":q},helpers:{encode:e}};var A="outside",B="inside",C={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},D=/[-[\](){}*+?.,\\^$|#\s]/g,E=/&(?!#?\w+;)|<|>|"|'|\//g,F=function(){return this||(0,eval)("this")}();if(void 0!==F){var G=F.atat;z.noConflict=function(){return F.atat=G,z}}"undefined"!=typeof module&&module.exports?module.exports=z:"function"==typeof define&&define.amd?define(function(){return z}):F.atat=z}();