/*! atat 2017-03-28 */
!function(){"use strict";function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function b(a,b,c){var d=this;g(m(a,b.inline),function(a,c,e,f){if(a.name==D)return b.parts.push(a.value),void f(null,"this.output += this.parts["+(b.parts.length-1)+"];");if(a.name==E){var g=a.left,h=a,i=a.right;if(""==h.value.trim())return void f(null,"");var j=b.compiler(g.value+h.value+i.value);return j?void j.call(d,h,b,f):(b.parts.push(g.value+h.value+i.value),void f("this.output += this.parts["+(b.parts.length-1)+"];"))}},function(a,b){if(a)return c(a);c(null,b.join(""))})}function c(a){var b=[];return f(a,function(a,c){b.indexOf(c)===-1&&b.push(c)}),{open:new RegExp(b.join("|"),"g"),close:/}@/g}}function d(a){var b=[];return f(a,function(a,c){b.push(c)}),new RegExp(b.join("|"),"g")}function e(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toString().replace(G,function(a){return F[a]||a})}function f(a,b){if("[object Array]"===Object.prototype.toString.call(a))for(var c=0,d=a.length;c<d;c++)b(a[c],c,a);else for(var e in a)a.hasOwnProperty(e)&&b(a[e],e,a)}function g(a,b,c){for(var d=0,e=!1,f=[],g=a.length,h=0;h<g;h++)b(a[h],h,a,function(a){return function(b,h){if(b&&!e)return e=!0,void c(b);f[a]=h,d++,e||d!=g||(e=!0,c(null,f))}}(h))}function h(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var c in a)!b.hasOwnProperty(c)&&a.hasOwnProperty(c)&&("object"==y(a[c])?b[c]=h(a[c]):b[c]=a[c]);return b}function i(a,b,c){for(var d=b.global,e=b.sticky,f=[],g=0,h=0,i=0,j=0,l=void 0,m=void 0,n=void 0,o=void 0;;){if(n=k(a,b,i),o=k(a,c,i),n&&o&&(n.index<=o.index?o=null:n=null),n||o)h=(n||o).index,i=h+(n||o)[0].length;else if(!g)break;if(e&&!g&&h>j)break;if(n)g||(l=h,m=i),++g;else{if(!o||!g)throw new Error("Unbalanced delimiter found in string");if(!--g&&(l>j&&f.push({name:D,value:a.slice(j,l),start:j,end:l}),f.push({name:E,value:a.slice(m,h),start:m,end:h,left:{value:a.slice(l,m),start:l,end:m},right:{value:a.slice(h,i),start:h,end:i}}),j=i,!d))break}h===i&&++i}return d&&a.length>j&&f.push({name:D,value:a.slice(j),start:j,end:a.length}),f}function j(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;b.lastIndex=c;var d=b.test(a);return b.global&&(b.lastIndex=d?b.lastIndex:0),d}function k(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;b.lastIndex=c;var d=b.exec(a);return b.global&&(b.lastIndex=d?b.lastIndex:0),d}function l(a){for(var b=0;b<a.length;b++)void 0===a[b]&&(a.splice(b,1),b--)}function m(a,b){for(var c=b.global,d=b.sticky,e=[],f=0,g=0,h=void 0,i=void 0;;){var j=k(a,b,f);if(null==j)break;if(g=j.index,d&&g>f)break;if(l(j),h=g+j[1].length,i=f+h+j[2].length,g>f&&e.push({name:D,value:a.slice(f,g),start:f,end:g}),e.push({name:E,value:j[2],start:h,end:i,left:{value:j[1],start:g,end:h},right:{value:j[3],start:i,end:i+j[3].length}}),f=g+j[0].length,!c)break}return c&&a.length>f&&e.push({name:D,value:a.slice(f),start:f,end:a.length}),e}function n(a,b,c){c(null,a.value.trim())}function o(a,b,c){var d="for("+a.value+"}",e=i(d,/\{/g,/\}/g),f="";f+=e[0].value,f+="{",this.compile(e[1].value,b,function(a,b){if(a)return c(a);f+=b,f+="}",c(null,f)})}function p(a,b,c){c(null,a.left.value.trim().substring(1)+a.value.trim()+"}")}function q(a,b,c){var d=this;g(i("if("+a.value+"}",/\{/g,/\}/g),function(a,c,e,f){if(a.name==D)return f(null,a.value);d.compile(a.value,b,f)},function(a,b){if(a)return c(a);c(null,b.join(""))})}function r(a,b,c){c(null,"this.output += $.encode(("+a.value.trim()+')||"");')}function s(a,b,c){c(null,"this.output += (("+a.value.trim()+')||"");')}function t(a,b,c){if(b.__layout)return c();C.compileUri(a.value.trim(),b.options,function(a,d){if(a)return c(a);b.__layout=d,d.__context.parent=b,c()})}function u(a,b,c){var d=a.value.trim(),e=k(d,/^([^\s]*)\s/g);if(!e&&""==d)return c(new Error("Partial parsing error"));var f=e?e[0]:d,g="";e&&2==e.length&&(f=e[1],g=d.slice(e[0].length).trim()),C.compileUri(f,b.options,function(a,d){if(a)return c(a);b.__partials.push(d),d.__context.parent=b;var e="this.output += this.__partials["+(b.__partials.length-1)+"]("+g+");";c(null,e)})}function v(a,b,c){c(null,"this.output += (function(){var s = this.section('"+a.value.trim()+"'); return s?s("+b.arguments+'):"";}).call(this);')}function w(a,b,c){var d=a.value.trim(),e=a.left.value.trim(),f=k(e,/^@section\s+([A-Za-z0-9]+)\s*\{/g);if(!f||f.length>2)return c(new Error("Section parsing error"));var g=f[1].trim();if(b.__sections[g])return c(new Error("Section already exists"));C.compile(d,b.options,function(a,d){if(a)return c(a);b.__sections[g]=d,d.__context.parent=b,c(null)})}function x(a,b,c){var d="while("+a.value+"}",e=i(d,/\{/g,/\}/g),f="";f+=e[0].value,f+="{",this.compile(e[1].value,b,function(a,b){if(a)return c(a);f+=b,f+="}",c(null,f)})}var y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},z=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),A=function(){function c(){a(this,c)}return z(c,[{key:"compile",value:function(a,c,d){var e=this;g(i(a,c.tags.open,c.tags.close),function(a,d,f,g){if(a.name==D)return""==a.value.trim()?void g(null,""):void b.call(e,a.value,c,g);if(a.name==E){var h=a.left,i=a,j=a.right,k=c.compiler(h.value);return k?void k.call(e,i,c,g):void b.call(e,h.value+i.value+j.value,c,g)}},function(a,b){if(a)return d(a);d(null,b.join(""))})}}]),c}(),B=function(){function b(e){var g=this;a(this,b),this.options=h(C.options,e),this.output="",this.model=null,this.helpers=this.options.helpers,this.parts=[],this.arguments=[this.options.modelname,this.options.helpersname,"body"].join(","),this.tags=c(this.options.tags),this.inline=d(this.options.inline),this.tags.compilers=[],f(this.options.tags,function(a,b){g.tags.compilers.push({compiler:a,regexp:new RegExp(b,"g")})}),f(this.options.inline,function(a,b){g.tags.compilers.push({compiler:a,regexp:new RegExp(b,"g")})}),this.__layout=null,this.__partials=[],this.__sections={},this.parent=null}return z(b,[{key:"section",value:function(a){return a?this.__sections[a]||this.parent&&this.parent.section(a):null}},{key:"compiler",value:function(){for(var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",b=0,c=this.tags.compilers.length;b<c;b++){var d=this.tags.compilers[b];if(j(a,d.regexp))return d.compiler}return null}}]),b}(),C=function(){function b(){a(this,b)}return z(b,null,[{key:"compileUri",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};arguments.length>2&&void 0!==arguments[2]&&arguments[2];b,"function"==typeof b&&(b={})}},{key:"compile",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};"function"==typeof b&&(c=b,b={});var d=new B(b);(new A).compile(a,d,function(a,b){if(a)return c(a);var e=new Function(d.arguments,b+";return this.output;");d.template=function(a){d.output="",d.model=a||d.model;var b=e.call(d,d.model,d.helpers,d.body);return d.__layout&&(d.__layout.__context.body=b,b=d.__layout(d.model)),b},d.template.__context=d,c(null,d.template)})}}]),b}();C.options={modelname:"model",helpersname:"$",tags:{"@\\{":n,"@if\\s*\\(":q,"@while\\s*\\(":x,"@for\\s*\\(":o,"@function\\s+[$A-Za-z0-9]*\\s*\\(":p,"@section\\s+[$A-Za-z0-9]*\\s*\\{":w},inline:{"(@section\\()([^]*?)(\\)@)":v,"(@layout\\()([^]*?)(\\)@)":t,"(@partial\\()([^]*?)(\\)@)":u,"(@\\()([^]*?)(\\)@)":r,"(@!\\()([^]*?)(\\)@)":s},helpers:{encode:e}};var D="outside",E="inside",F={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},G=/&(?!#?\w+;)|<|>|"|'|\//g,H=function(){return this||(0,eval)("this")}();if(void 0!==H){var I=H.atat;C.noConflict=function(){return H.atat=I,C}}"undefined"!=typeof module&&module.exports?module.exports=C:"function"==typeof define&&define.amd?define(function(){return C}):H.atat=C}();